#!/usr/bin/env python
#Author: St0rn
#
#Simple ISN Calculator
#
#argv[1] = target_ip ; argv[2] = Destination Port ; argv[3] = Source Port ; argv[4] = Number of packets
#

from scapy.all import *
import sys
import os

isn = []
l = 0

if len(sys.argv) < 5:
 print "\nUsage: " + sys.argv[0] + "<Target_IP> <Destination Port> <Source Port> <Number of packets>"
else:
 os.system("clear")
 print "\n"

 while l != int(sys.argv[4]):
  ip = IP(dst = sys.argv[1])
  tcp = TCP(flags = "S",seq = random.randrange(1000, 100000), dport = int(sys.argv[2]), sport = int(sys.argv[3]))
  packet = ip/tcp
  p = sr1(packet, verbose = 0)
  if p.haslayer(IP) and p.haslayer(TCP) and p[IP].src == sys.argv[1]:
   isn.append(p[TCP].seq)
  l = l+1
  print "Send with ISN " + str(tcp.seq)

 print "\n"
 for i in range(0, int(sys.argv[4])-1):
  calc = isn[i+1] - isn[i]
  next = isn[i] + calc
  print "ISN: " + str(isn[i]) + " | " + "ISN Difference: " + str(calc) + " | " + "Next ISN: " + str(next)
 print "\n"
